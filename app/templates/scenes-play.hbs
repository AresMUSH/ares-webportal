{{title 'Play'}}
 
 <h1>Play</h1>

   
       <p>
         Here you can chat and participate in scenes you have joined or watched.
       </p>
       

 <div class="row">
   <div class="col col-xs-12 col-md-3">
     
     <div class="play-sidebar">
     
     <button class="btn btn-default visible-sm visible-xs hidden-md" type="button" data-toggle="collapse" data-target="#sceneMenuCollapse" aria-expanded="false" aria-controls="sceneMenuCollapse">
         <i class="fas fa-bars"></i>
         {{#if anyNewActivity}}
         <span class="label label-pill label-primary"> <i class="fa fa-flag" aria-label="New Activity"></i></span>
         {{/if}}
       </button>

       <div class="collapse in" id="sceneMenuCollapse">

       <p class="play-section-title">Scenes
       <LinkTo @route="scene-create" @target="_blank"><i class="fa fa-plus-circle" aria-label="Add Channel"></i></LinkTo>
       </p>  

         
       {{#each model.scenes as |scene|}}
         <a href="#" {{action 'switchScene' scene.id}}>
           <div class="play-selector {{if (eq scene.id currentScene.id) 'play-selector-active' ''}}">
               #{{scene.id}} - {{scene.location.name}} 
               {{#if scene.is_unread}}
                 <span class="label label-pill label-primary"> <i class="fa fa-flag" aria-label="New Activity"></i></span>
               {{/if}}
           </div>
         </a>
         <div class="play-participants">
           {{#each scene.participants as |participant|}}
             {{participant.name}}
           {{/each}}
         </div>
         
       {{/each}}
       
       
       <p class="play-section-title">Private Messages  
       <a href="#" {{action (mut newConversation) true}}><i class="fa fa-plus-circle" aria-label="New Conversation"></i></a>
       </p>  
        
        {{#each model.chat as |channel|}}
         {{#if channel.is_page}}
            {{#if channel.can_join}}
              {{#if channel.enabled}}
               <a href="#" {{action 'changeChannel' channel}}>
                <div class="play-selector {{if (eq channel.key selectedChannel.key) 'play-selector-active' ''}}">                  
                  # {{channel.title}}
                  {{#if channel.muted}}
                      <i class="fa fa-microphone-slash"></i>
                  {{/if}}
                  {{#if channel.is_unread}}
                    <span class="label label-pill label-primary"> <i class="fa fa-flag" aria-label="New Activity"></i></span>
                  {{/if}}
                </div>
              </a>
              {{/if}}
            {{/if}}
          {{/if}}
        {{/each}}        
       
       <p class="play-section-title">Channels
       <a href="#" {{action (mut showAddChannel) true}}><i class="fa fa-plus-circle" aria-label="Add Channel"></i></a>
       </p>  
              
       {{#each model.chat as |channel|}}
         {{#if (not channel.is_page)}}
           {{#if channel.can_join}}
             {{#if channel.enabled}}
               <a href="#" {{action 'changeChannel' channel}}>
                 <div class="play-selector {{if (eq channel.key selectedChannel.key) 'play-selector-active' ''}}">
                      # {{channel.title}}
                     {{#if channel.muted}}
                         <i class="fa fa-microphone-slash"></i>
                     {{/if}}                 
                     <span class="label label-pill label-primary">{{channel.new_messages}}</span>
                 </div>
                 </a>
             {{/if}}
           {{/if}}
         {{/if}}
       {{/each}}
                         
     </div>
    </div>
     
   </div>
   
   <div class="col col-xs-12 col-md-9">
      
      {{#if currentScene}}
      <h3>Scene {{currentScene.id}} - {{currentScene.icdate}}
          {{#if currentScene.title}}
           - {{currentScene.title}}
           {{/if}}
       </h3>
    
       <LiveSceneControl @scene={{currentScene}} @locations={{model.locations}} @abilities={{model.abilities}} @places={{currentScene.places}} @scrollPaused={{scrollPaused}} @playerName={{currentUser.name}} @refresh={{action "refresh"}} @scrollDown={{action "scrollDown"}} @setScroll={{action "setScroll"}} />
       
       {{/if}}
       
       {{#if selectedChannel}}

       <h3>{{selectedChannel.title}}</h3>
       
         <ChatControl @channel={{selectedChannel}} @scrollPaused={{scrollPaused}} @playerName={{currentUser.name}} @refresh={{action "refresh"}} @scrollDown={{action "scrollDown"}} @setScroll={{action "setScroll"}} />
       
       {{/if}}

    </div>
</div>
  
<BsModalSimple @title="Add Channel" @submitTitle="Done" @size={{null}} @fade={{false}} @closeTitle="Cancel" @open={{showAddChannel}}  @onHide={{action (mut showAddChannel) null}}>
  
  <table>
    {{#each model.chat as |channel|}}
      {{#if channel.can_join}}
        {{#if (not channel.enabled)}}
        <tr>
          <td>
          <b>{{channel.title}}</b> 
          </td>
          <td>
            {{#if channel.desc}}
            {{channel.desc}}
            {{else}}
            No description.
            {{/if}}
          </td>
          <td>
            <a href="#" {{action 'joinChannel' channel.title}} class="btn btn-primary">Join</a>
          </td>
        </tr>
        {{/if}}
      {{/if}}
  {{/each}}
  </table>
</BsModalSimple>
  
<BsModalSimple @title="Start Conversation" @closeTitle="Cancel" @submitTitle="Start" @size={{null}} @fade={{false}} @open={{newConversation}} @onSubmit={{action "startConversation"}}  @onHide={{action (mut newConversation) null}}>


         <div class="panel panel-default">
           <div class="panel-body">
             <b>To:</b><PowerSelectMultiple @selected={{newConversationList}} @options={{model.characters}} @searchField="name" @onchange={{action "conversationListChanged"}} as |char|>
                 {{char.name}}
               </PowerSelectMultiple>
      
               <CmdBox @value={{chatMessage}} @class="chat-box" @cols="80" @rows="6" @onEnter={{action "startConversation"}} />
      
           </div>
         </div>
  </BsModalSimple>
  

{{outlet}}